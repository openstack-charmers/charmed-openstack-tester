# Please refer to the OpenStack Charms Deployment Guide for more information.
# https://docs.openstack.org/project-deploy-guide/charm-deployment-guide
series: bionic
variables:
  worker-multiplier: &worker-multiplier 0.25
  block-devices: &block-devices /dev/sdb /dev/vdb
machines:
  '0':
    constraints: tags=uosci
  '1':
    constraints: tags=uosci
  '2':
    constraints: tags=uosci
relations:
- - keystone:shared-db
  - mysql:shared-db
- - swift-proxy:identity-service
  - keystone:identity-service
- - swift-proxy:swift-storage
  - swift-storage-z1:swift-storage
- - swift-proxy:swift-storage
  - swift-storage-z2:swift-storage
- - swift-proxy:swift-storage
  - swift-storage-z3:swift-storage

applications:
  keystone:
    charm: cs:keystone
    num_units: 1
    options:
      worker-multiplier: *worker-multiplier
    to:
    - lxd:0
    bindings:
      "": public-space
  mysql:
    charm: cs:percona-cluster
    num_units: 1
    options:
      dataset-size: 50%
      max-connections: 20000
      root-password: ChangeMe123
      sst-password: ChangeMe123
    to:
    - lxd:0
    bindings:
      "": public-space
  swift-proxy:
    charm: cs:swift-proxy
    num_units: 1
    options:
      replicas: 3
      swift-hash: fdfef9d4-8b06-11e2-8ac0-531c923c8fae
      zone-assignment: manual
    to:
    - lxd:1
    bindings:
      "": public-space
  swift-storage-z1:
    charm: cs:swift-storage
    num_units: 1
    options:
      zone: 1
      block-device: *block-devices
      worker-multiplier: *worker-multiplier
    to:
    - 0
    bindings:
      "": public-space
  swift-storage-z2:
    charm: cs:swift-storage
    num_units: 1
    options:
      zone: 2
      block-device: *block-devices
      worker-multiplier: *worker-multiplier
    to:
    - 1
    bindings:
      "": public-space
  swift-storage-z3:
    charm: cs:swift-storage
    num_units: 1
    options:
      zone: 3
      block-device: *block-devices
      worker-multiplier: *worker-multiplier
    to:
    - 2
    bindings:
      "": public-space
